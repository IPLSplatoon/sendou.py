name: Pull request

# Make sure only the latest push to the PR's source branch runs and cancel any on-going previous run
concurrency:
  group: ${{ github.head_ref }}
  cancel-in-progress: true

on:
  pull_request:

jobs:
  Pull-Request:
    runs-on: ubuntu-latest
    steps:
      - name: Check out repository
        uses: actions/checkout@v4
      - name: Set up python
        id: setup-python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - name: Install Poetry
        uses: snok/install-poetry@v1
        with:
          virtualenvs-create: true
          virtualenvs-in-project: true
          installer-parallel: true
      - name: Install dependencies
        run: poetry install --no-interaction --no-root  --with=dev
      - name: Check Schema Hash with upstream
        run: python scripts/checkUpstreamSchema.py
      - name: Install library
        run: |
          source .venv/bin/activate
          poetry install --no-interaction
      - name: Run Pytest
        uses: pavelzw/pytest-action@v2
        with:
          verbose: false
          emoji: false
          job-summary: true
          click-to-expand: true
          report-title: 'Test Report'
